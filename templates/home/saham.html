
{% extends 'home/base.html' %}
{% load humanize %}
{% block title %}{{ article.title }}{% endblock %}
{% block description %}{{ article.excerpt }}{% endblock %}
{% block meta %}
    <meta name="description" content="{{ article.excerpt }}">
    <meta name="keywords" content="{{ article.keywords }}">
    <meta name="author" content="{{ article.author }}">
    <meta name="robots" content="index, follow">
    <meta name="googlebot" content="index, follow">
    <meta name="google" content="notranslate">
    <style>
        .filter-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .filter-title {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: #121212;
            border-bottom: 2px solid #08c461;
            padding-bottom: 10px;
        }
        
        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
        }
        
        .filter-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #555;
            font-size: 0.9rem;
        }
        
        .filter-group input,
        .filter-group select {
            padding: 10px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 0.95rem;
            transition: border-color 0.3s;
        }
        
        .filter-group input:focus,
        .filter-group select:focus {
            outline: none;
            border-color: #08c461;
        }
        
        .range-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #08c461 0%, #2ada7c 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #f0f0f0;
            color: #000000;
        }
        
        .btn-secondary:hover {
            background: #e0e0e0;
        }
        
        .results-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .results-count {
            font-size: 1.1rem;
            color: #555;
        }
        
        .sort-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .sort-group select {
            padding: 8px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        
        .table-responsive {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }
        
        thead {
            background: #f8f9fa;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        
        th {
            font-weight: 600;
            color: #555;
            font-size: 0.9rem;
            text-transform: uppercase;
        }
        
        tbody tr:hover {
            background: #f8f9fa;
        }
        
        .stock-symbol {
            font-weight: 700;
            color: #08c461;
            font-size: 1rem;
        }
        
        .stock-name {
            color: #666;
            font-size: 0.85rem;
        }
        
        .price-filter {
            font-weight: 700;
            font-size: 1.1rem;
        }
        
        .change-positive {
            color: #10b981;
        }
        
        .change-negative {
            color: #ef4444;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .badge-sector {
            background: #e0e7ff;
            color: #4338ca;
        }
        
        .badge-papan {
            background: #fef3c7;
            color: #92400e;
        }
        
        .no-results {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }
        
        .no-results svg {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .filter-toggle {
            display: none;
            background: #08c461;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            width: 100%;
            font-size: 1rem;
            margin-bottom: 15px;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5rem;
            }
            
            .filter-grid {
                grid-template-columns: 1fr;
            }
            
            .filter-toggle {
                display: block;
            }
            
            .filter-content {
                display: none;
            }
            
            .filter-content.active {
                display: block;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .results-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .sort-group {
                width: 100%;
            }
            
            .sort-group select {
                flex: 1;
            }
        }
    </style>
{% endblock %}
{% block content %}


<main class="content-area">
<div class="main-content">
<div class="filter-section">
            <button class="filter-toggle" onclick="toggleFilter()">
                â˜° Tampilkan/Sembunyikan Filter
            </button>
            
            <div class="filter-content">
                <h2 class="filter-title">Filter Saham</h2>
                
                <form method="GET" action="">
                    <!-- Search & Basic Filter -->
                    <div class="filter-grid">
                        <div class="filter-group">
                            <label>Cari Saham (Symbol/Nama)</label>
                            <input type="text" name="search" value="{{ search }}" placeholder="Contoh: BBCA, Bank Central Asia">
                        </div>
                        
                        <div class="filter-group">
                            <label>Sektor</label>
                            <select name="sektor">
                                <option value="">Semua Sektor</option>
                                {% for sek in sektor_list %}
                                <option value="{{ sek }}" {% if sektor == sek %}selected{% endif %}>{{ sek }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label>Papan Pencatatan</label>
                            <select name="papan">
                                <option value="">Semua Papan</option>
                                {% for pap in papan_list %}
                                <option value="{{ pap }}" {% if papan == pap %}selected{% endif %}>{{ pap }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    
                    <!-- Price Range -->
                    <div class="filter-grid">
                        <div class="filter-group">
                            <label>Rentang Harga (Rp)</label>
                            <div class="range-group">
                                <input type="number" name="price_min" value="{{ price_min }}" placeholder="Min" step="0.01">
                                <input type="number" name="price_max" value="{{ price_max }}" placeholder="Max" step="0.01">
                            </div>
                        </div>
                        
                        <div class="filter-group">
                            <label>Perubahan Harga (%)</label>
                            <div class="range-group">
                                <input type="number" name="change_pct_min" value="{{ change_pct_min }}" placeholder="Min" step="0.01">
                                <input type="number" name="change_pct_max" value="{{ change_pct_max }}" placeholder="Max" step="0.01">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Market Cap & Volume -->
                    <div class="filter-grid">
                        <div class="filter-group">
                            <label>Market Cap (Rp)</label>
                            <div class="range-group">
                                <input type="number" name="market_cap_min" value="{{ market_cap_min }}" placeholder="Min">
                                <input type="number" name="market_cap_max" value="{{ market_cap_max }}" placeholder="Max">
                            </div>
                        </div>
                        
                        <div class="filter-group">
                            <label>Volume</label>
                            <div class="range-group">
                                <input type="number" name="volume_min" value="{{ volume_min }}" placeholder="Min">
                                <input type="number" name="volume_max" value="{{ volume_max }}" placeholder="Max">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Valuation Metrics -->
                    <div class="filter-grid">
                        <div class="filter-group">
                            <label>P/E Ratio</label>
                            <div class="range-group">
                                <input type="number" name="pe_min" value="{{ pe_min }}" placeholder="Min" step="0.01">
                                <input type="number" name="pe_max" value="{{ pe_max }}" placeholder="Max" step="0.01">
                            </div>
                        </div>
                        
                        <div class="filter-group">
                            <label>P/BV Ratio</label>
                            <div class="range-group">
                                <input type="number" name="pbv_min" value="{{ pbv_min }}" placeholder="Min" step="0.01">
                                <input type="number" name="pbv_max" value="{{ pbv_max }}" placeholder="Max" step="0.01">
                            </div>
                        </div>
                        
                        <div class="filter-group">
                            <label>Dividend Yield (%)</label>
                            <div class="range-group">
                                <input type="number" name="div_yield_min" value="{{ div_yield_min }}" placeholder="Min" step="0.01">
                                <input type="number" name="div_yield_max" value="{{ div_yield_max }}" placeholder="Max" step="0.01">
                            </div>
                        </div>
                    </div>
                    
                    <div class="button-group">
                        <button type="submit" class="btn btn-primary">Filter Saham</button>
                        <button type="button" class="btn btn-secondary" onclick="resetFilter()">Reset Filter</button>
                    </div>
                </form>
            </div>
        </div>
        
        <div class="results-section">
            <div class="results-header">
                <div class="results-count">
                    <strong>{{ saham_list.count }}</strong> saham ditemukan
                </div>
                
                <form method="GET" action="" class="sort-group">
                    {% for key, value in request.GET.items %}
                        {% if key != 'sort' %}
                        <input type="hidden" name="{{ key }}" value="{{ value }}">
                        {% endif %}
                    {% endfor %}
                    <label>Urutkan:</label>
                    <select name="sort" onchange="this.form.submit()">
                        <option value="-price" {% if sort == '-price' %}selected{% endif %}>Harga (Tinggi ke Rendah)</option>
                        <option value="price" {% if sort == 'price' %}selected{% endif %}>Harga (Rendah ke Tinggi)</option>
                        <option value="-change_pct" {% if sort == '-change_pct' %}selected{% endif %}>Perubahan (Tertinggi)</option>
                        <option value="change_pct" {% if sort == 'change_pct' %}selected{% endif %}>Perubahan (Terendah)</option>
                        <option value="-market_cap" {% if sort == '-market_cap' %}selected{% endif %}>Market Cap (Terbesar)</option>
                        <option value="market_cap" {% if sort == 'market_cap' %}selected{% endif %}>Market Cap (Terkecil)</option>
                        <option value="-volume" {% if sort == '-volume' %}selected{% endif %}>Volume (Tertinggi)</option>
                        <option value="pe" {% if sort == 'pe' %}selected{% endif %}>P/E Ratio (Terendah)</option>
                        <option value="-div_yield" {% if sort == '-div_yield' %}selected{% endif %}>Div Yield (Tertinggi)</option>
                        <option value="symbol" {% if sort == 'symbol' %}selected{% endif %}>Symbol (A-Z)</option>
                    </select>
                </form>
            </div>
            
            {% if saham_list %}
            <div class="table-responsive">
                <table>
                    <thead>
                        <tr>
                            <th>Symbol</th>
                            <th>Harga</th>
                            <th>Perubahan</th>
                            <th>Volume</th>
                            <th>Market Cap</th>
                            <th>P/E</th>
                            <th>P/BV</th>
                            <th>Div Yield</th>
                            <th>Sektor</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for saham in saham_list %}
                        <tr>
                            <td>
                                <div class="stock-symbol"><a href="{% url 'saham_detail' saham.symbol %}">{{ saham.symbol }}</a></div>
                                <div class="stock-name">{{ saham.short_name|truncatewords:3 }}</div>
                            </td>
                            <td class="price-filter" style="white-space: nowrap;">
                                {% if saham.price %}
                                    Rp {{ saham.price|floatformat:0 }}
                                {% else %}
                                    -
                                {% endif %}
                            </td>
                            <td>
                                {% if saham.change_pct %}
                                    <span class="{% if saham.change_pct >= 0 %}change-positive{% else %}change-negative{% endif %}">
                                        {{ saham.change_pct|floatformat:2 }}%
                                    </span>
                                {% else %}
                                    -
                                {% endif %}
                            </td>
                            <td>
                                {% if saham.volume %}
                                    {{ saham.volume|floatformat:0|intcomma }}
                                {% else %}
                                    -
                                {% endif %}
                            </td>
                            <td>
                                {% if saham.market_cap %}
                                    {{ saham.market_cap|intcomma }}
                                {% else %}
                                    -
                                {% endif %}
                            </td>
                            <td>{{ saham.pe|floatformat:2|default:"-" }}</td>
                            <td>{{ saham.pbv|floatformat:2|default:"-" }}</td>
                            <td>
                            {% if saham.div_yield_display is not None %}
                                {{ saham.div_yield_display|floatformat:2 }}%
                            {% else %}
                                -
                            {% endif %}
                            </td>
                            <td>
                                {% if saham.sektor %}
                                    <span class="badge badge-sector">{{ saham.sektor|truncatewords:2 }}</span>
                                {% else %}
                                    -
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="no-results">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <h3>Tidak ada saham yang ditemukan</h3>
                <p>Coba ubah kriteria filter Anda</p>
            </div>
            {% endif %}
        </div>
            </div>
        </main>
           <script>
        function toggleFilter() {
            const filterContent = document.querySelector('.filter-content');
            filterContent.classList.toggle('active');
        }
        
        function resetFilter() {
            window.location.href = window.location.pathname;
        }
        
        // Hapus parameter kosong sebelum submit
        document.addEventListener('DOMContentLoaded', function() {
            const forms = document.querySelectorAll('form');
            forms.forEach(form => {
                form.addEventListener('submit', function(e) {
                    // Ambil semua input dan select
                    const inputs = form.querySelectorAll('input, select');
                    inputs.forEach(input => {
                        // Hapus input yang kosong atau default
                        if (!input.value || input.value === '' || input.value === 'Semua Sektor' || input.value === 'Semua Papan') {
                            input.removeAttribute('name');
                        }
                    });
                });
            });
        });
    </script>
{% endblock %}
